# Enable headers module
<IfModule mod_headers.c>
    # Remove any existing Access-Control headers to prevent duplicates
    Header always unset Access-Control-Allow-Origin
    Header always unset Access-Control-Allow-Methods
    Header always unset Access-Control-Allow-Headers
    Header always unset Access-Control-Allow-Credentials
    Header always unset Access-Control-Max-Age
    
    # Set CORS headers for all requests
    # PRODUCTION DOMAINS
    SetEnvIf Origin "^https://admin\.gamius\.ma$" ORIGIN_ALLOWED=$0
    SetEnvIf Origin "^https://user\.gamius\.ma$" ORIGIN_ALLOWED=$0
    SetEnvIf Origin "^https://api\.gamius\.ma$" ORIGIN_ALLOWED=$0
    SetEnvIf Origin "^https://([a-z0-9-]+\.)?gamius\.ma$" ORIGIN_ALLOWED=$0
    
    # DEVELOPMENT DOMAINS (remove these in production if not needed)
    SetEnvIf Origin "^http://localhost:3000$" ORIGIN_ALLOWED=$0
    SetEnvIf Origin "^http://localhost:3001$" ORIGIN_ALLOWED=$0
    SetEnvIf Origin "^http://127\.0\.0\.1:3000$" ORIGIN_ALLOWED=$0
    SetEnvIf Origin "^http://127\.0\.0\.1:3001$" ORIGIN_ALLOWED=$0
    
    # Set headers if origin is allowed
    Header always set Access-Control-Allow-Origin "%{ORIGIN_ALLOWED}e" env=ORIGIN_ALLOWED
    Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT, PATCH" env=ORIGIN_ALLOWED
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, Accept, Origin" env=ORIGIN_ALLOWED
    Header always set Access-Control-Allow-Credentials "true" env=ORIGIN_ALLOWED
    Header always set Access-Control-Max-Age "3600" env=ORIGIN_ALLOWED
    
    # If origin is not in allowed list, set a fallback (optional - remove if you want strict control)
    # Header always set Access-Control-Allow-Origin "https://admin.gamius.ma" env=!ORIGIN_ALLOWED
</IfModule>

# Handle preflight OPTIONS requests
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Handle OPTIONS requests for CORS preflight
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>

# PHP settings
<IfModule mod_php.c>
    php_flag display_errors Off
    php_flag log_errors On
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value max_execution_time 300
    php_value max_input_time 300
</IfModule>

# Security headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
</IfModule>

